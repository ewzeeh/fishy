<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-147409455-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-147409455-1');
</script>

  <link rel="shortcut icon" href="favicon.png" />
  <meta charset="utf-8">
  <title>Fishy // Profil</title>
  <link rel="stylesheet" type="text/css" href="css/bootstrap.css">
  <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css" />
  <link rel="stylesheet" href="css/style.css">
  <script src="https://www.gstatic.com/firebasejs/live/3.1/firebase.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="js/app.js"></script>
</head>

<body>
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script src="js/bootstrap.min.js"></script>

  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo01" aria-controls="navbarTogglerDemo01" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarTogglerDemo01">
      <a class="navbar-brand" href="overview.html"><img class="logo" src="img/logo.png"></a>
      <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
        <li class="nav-item">
          <a class="nav-item nav-link" href="overview.html">Registrering <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-item nav-link" href="records.html">Rekorder</a>
        </li>
      </ul>
      <a class="btn btn-outline-primary" href="profile.html" role="button">Profil</a>
      <button onclick="signOut()" class="btn btn-outline-danger my-2 my-sm-0" type="submit">Logg ut</button>
    </div>
  </nav>


  <div class="container">
    <div class="container">
      <div id="nickAlert" class="alert alert-info alert-dismissible fade show" role="alert">
        Husk å legge inn brukernavn i <a href="profile.html">profilen</a> din før du legger til fangsten din!
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <h1>Profil</h1>

      <hr>
      <!--      <button onclick="getUserData()">Brukerdata</button><br>-->
      <p id="feedback"></p>
      <label for="usernameEdit">Velg eller endre brukernavn:</label>
      <input type="text" class="form-control" id="usernameEdit" placeholder="Velg eller endre brukernavn her">
      <label for="userImgEdit">Legg inn full link til profilbilde:<br> <i>(Eks: http://snaps.aarvikgudmundsen.no/2.png)<br>Husk å ha med http</i></label>
      <input type="text" class="form-control" id="userImgEdit" placeholder="Legg inn link til profilbilde her" value="">
      <button onclick="updateUserData()" type="button" class="btn btn-reg">Endre / Oppdater</button><br />

      <div class="container mt-3">
        <h2>Last opp bilde:</h2>
        <progress value="0" max="100" id="uploader">0%</progress><br />
        <input type="file" value="upload" id="fileButton" />
        <img id="profilePicture">
      </div>
      <hr>


      <div class="col-md-3">
        <div class="profile-sidebar">
          <!-- SIDEBAR USERPIC -->
          <div class="profile-userpic">
            <span id="usrImg"></span>
          </div>
          <!-- END SIDEBAR USERPIC -->
          <!-- SIDEBAR USER TITLE -->
          <div class="profile-usertitle">
            <div class="profile-usertitle-name">
              <span id="usrUsername"></span>
            </div>
            <div class="profile-usertitle-job">
              <span id="usrEmail"></span>
            </div>
          </div>
          <!-- END SIDEBAR USER TITLE -->
          <!-- SIDEBAR BUTTONS -->
          <div class="profile-userbuttons">
            <button type="button" class="btn btn-success btn-sm">Endre passord</button>
            <button onclick="signOut()" type="button" class="btn btn-danger btn-sm">Logg ut</button>
          </div>
          <!-- END SIDEBAR BUTTONS -->

          <!-- END MENU -->
        </div>
      </div>


    </div>
  </div>

  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <!--  <script src="https://www.gstatic.com/firebasejs/6.6.0/firebase-app.js"></script>-->

  <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#config-web-app -->

     <script>
      //Handle Account Status
      firebase.auth().onAuthStateChanged(user => {
        if (!user) {
          window.location = 'index.html'; //If User is not logged in, redirect to login page
        } else {
          getUserData();
          console.log('Innlogget');
          showProfilePic();
          // const userr = firebase.auth().currentUser.email;
          // var nameOutput = userr.substring(0, userr.lastIndexOf("@"));
          // document.getElementById("usrloggedin").innerHTML = nameOutput;
        }
      });
    </script>
  <script>
    var uploader = document.getElementById('uploader');
    var fileButton = document.getElementById('fileButton');

    //Listen for file selection
    fileButton.addEventListener('change', function(e) {
      var user = firebase.auth().currentUser;
      console.log(user);
      // Get files
      var filename = 'profilbilde' + user.email.substring(0, user.email.lastIndexOf("@"));
      var file = e.target.files[0];

      // Create storageRef
      var storageRef = firebase.storage().ref();

      // Upload files
      var task = storageRef.child('profilepictures/' + filename).put(file);

      // Update progress bar
      task.on('state_changed',
        function progress(snapshot) {
          var percentage = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
          uploader.value = percentage;
        },

        function error(err) {

        },

        function complete() {

        }
      )
    });
  </script>
</body>

</html>
